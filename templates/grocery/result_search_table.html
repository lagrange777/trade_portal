<table class="table table-lightborder">
    <thead>
    <tr>
        <th class="text-left" width="10%">Прайс</th>
        <th class="text-left" width="7%">Поставщик</th>
        <th class="text-left" width="38%">Позиция</th>
        <th class="text-left" width="5%">Стоимость</th>
        <th class="text-left" width="5%">Кол-во</th>
        <th class="text-left" width="5%">Цена за ед.</th>
        <th class="text-left" width="10%">Наименование в 1С</th>
        <th class="text-left" width="5%"></th>
    </tr>
    </thead>
    <tbody class="search_result_table">
    {% for i in range(0, price_list|length) %}
        <tr>
            <td class="text-left" width="10%">
                <input id="price_name_{{ i }}"
                       class="form-control"
                       required="required"
                       type="text"
                       value="{{ price_list[i].price_name }}"
                       readonly>
            </td>
            <td class="text-left" width="10%">
                <input id="price_owner_name_{{ i }}"
                       class="form-control"
                       required="required"
                       type="text"
                       value="{{ price_list[i].price_owner_name }}">
            </td>
            <td class="text-left" width="35%">
                <input id="item_name_{{ i }}"
                       class="form-control"
                       required="required"
                       type="text"
                       value="{{ price_list[i].item_name }}"
                       readonly>
            </td>
            <td class="text-left" width="5%">
                <input id="item_full_price_{{ i }}"
                       class="form-control"
                       required="required"
                       type="text"
                       value="{{ price_list[i].full_price }}">
            </td>
            <td class="text-left" width="5%">
                <input id="item_qty_{{ i }}"
                       class="form-control"
                       required="required"
                       type="text"
                       value="{{ price_list[i].item_qty }}">
            </td>
            <td class="text-left" width="5%">
                <input id="item_unit_price_{{ i }}"
                       class="form-control"
                       required="required"
                       type="text"
                       value="{{ price_list[i].item_unit_price }}">
            </td>
            <td class="text-left" width="10%">
                <input id="item_home_book_name_{{ i }}"
                       class="form-control"
                       required="required"
                       type="text"
                       value="{{ price_list[i].item_home_book_name }}">
            </td>
            <td class="text-left" width="5%">
                <a class="btn btn-primary text-white" id="item_select_{{ i }}">Добавить</a>
            </td>
        </tr>
    {% endfor %}
    </tbody>
</table>

{#<div class="row mt-5 mb-5">#}
{#    <a class="btn btn-primary text-white save-price-btn mr-5">Сохранить прайс</a>#}
{#</div>#}
{#<script src="static/bower_components/jquery/dist/jquery.min.js"></script>#}
<script src="static/bower_components/popper.js/dist/umd/popper.min.js"></script>
<script src="static/bower_components/moment/moment.js"></script>
<script src="static/bower_components/chart.js/dist/Chart.min.js"></script>
{#<script src="static/bower_components/select2/dist/js/select2.full.min.js"></script>#}
<script src="static/bower_components/jquery-bar-rating/dist/jquery.barrating.min.js"></script>
<script src="static/bower_components/ckeditor/ckeditor.js"></script>
<script src="static/bower_components/bootstrap-validator/dist/validator.min.js"></script>
<script src="static/bower_components/bootstrap-daterangepicker/daterangepicker.js"></script>
<script src="static/bower_components/ion.rangeSlider/js/ion.rangeSlider.min.js"></script>
<script src="static/bower_components/dropzone/dist/dropzone.js"></script>
<script src="static/bower_components/editable-table/mindmup-editabletable.js"></script>
<script src="static/bower_components/datatables.net/js/jquery.dataTables.min.js"></script>
<script src="static/bower_components/fullcalendar/dist/fullcalendar.min.js"></script>
<script src="static/bower_components/perfect-scrollbar/js/perfect-scrollbar.jquery.min.js"></script>
<script src="static/bower_components/tether/dist/js/tether.min.js"></script>
<script src="static/bower_components/slick-carousel/slick/slick.min.js"></script>
<script src="static/bower_components/bootstrap/js/dist/util.js"></script>
<script src="static/bower_components/bootstrap/js/dist/alert.js"></script>
<script src="static/bower_components/bootstrap/js/dist/button.js"></script>
<script src="static/bower_components/bootstrap/js/dist/carousel.js"></script>
<script src="static/bower_components/bootstrap/js/dist/collapse.js"></script>
<script src="static/bower_components/bootstrap/js/dist/dropdown.js"></script>
<script src="static/bower_components/bootstrap/js/dist/modal.js"></script>
<script src="static/bower_components/bootstrap/js/dist/tab.js"></script>
<script src="static/bower_components/bootstrap/js/dist/tooltip.js"></script>
<script src="static/bower_components/bootstrap/js/dist/popover.js"></script>
<script src="static/js/demo_customizer.js?version=4.4.0"></script>
<script src="static/js/main.js?version=4.4.0"></script>
<script src="static/bower_components/bootstrap/js/dist/popover.js"></script>
{#<script src="static/js/dataTables.bootstrap4.min.js"></script>#}

<script>
    var mapa_items = {};
    var mapa_prices = {};
    var mapa_titles = {};
    var mapa_qtys = {};
    $(document).ready(function () {

        {% for index in range(0, price_list|length) %}
            $('#itemselector_{{index}}').change(function () {
                mapa_items['{{ index }}'] = $(this).val()
            });
        {% endfor %}

        $('.save-price-btn').click(function () {
            {% for index in range(0, price_list|length) %}
                mapa_prices['{{ index }}'] = $('#item_price_{{ index }}').val()
                mapa_titles['{{ index }}'] = $('#keyword_{{ index }}').val();
                mapa_qtys['{{ index }}'] = $('#item_qty_{{ index }}').val();
                mapa_items['{{ index }}'] = $('#itemselector_{{ index }}').val();
            {% endfor %}
            console.log(mapa_items)
            console.log(mapa_qtys)
            console.log(mapa_titles)
            console.log(mapa_prices)
            alert()
            let dialog_id = $('#dialog_id').val();
            let price_name = $('#price_name').val()
            if (price_name === '') {
                alert('Введите название прайса')
            } else {
                $.ajax({
                    url: "/api/save_price",
                    data: JSON.stringify({
                        items: mapa_items,
                        prices: mapa_prices,
                        titles: mapa_titles,
                        qtys: mapa_qtys,
                        dialog_id: dialog_id,
                        price_name: price_name
                    }),
                    contentType: 'application/json;charset=UTF-8',
                    method: 'POST',
                    success: function () {
                        alert('Прайс успешно сохранен')
                        window.location.reload(true);
                    },
                    error: function (error) {

                    }
                });
            }
        });
    })
</script>


